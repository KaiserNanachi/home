---
title: 夜間光データ及びSDID法を用いた実証分析
output:
  html_document:
    code_folding: hide
    toc: TRUE
    toc_depth: 3
    toc_float: TRUE
    number_sections: FALSE
    highlight: "pygments"
---

```{r ,echo=TRUE,include=TRUE,warning=FALSE,error=FALSE,message=FALSE}
library(tidyverse)
library(sf)
library(terra)
library(openxlsx)
library(mapview)
library(RColorBrewer)
library(osrm)
library(movecost)
library(fs)
library(stringr)
library(synthdid)
mapview::mapviewOptions(fgb=FALSE)
load("data/china.RData")
```

## 衛星夜間光データとは

![](images/earth_lights_lrg_Fotor.jpg){width="643"}

```{r}
ntl1992<-terra::rast(x="data/9828827/Harmonized_DN_NTL_1992_calDMSP.tif")
ntl2018<-terra::rast(x="data/9828827/Harmonized_DN_NTL_2018_simVIIRS.tif")
ntl1992 <- ntl1992 %>%
  terra::crop(y=ext(c(123.1,146.9,24.0,45.7)))
ntl2018 <- ntl2018 %>%
  terra::crop(y=ext(c(123.1,146.9,24.0,45.7)))
```

1992年日本

```{r}
terra::plot(ntl1992)
```

2018年日本　若干赤くなってる？

```{r}
terra::plot(ntl2018)
```

## Synthetic DID法とは

**SDID法は[差分の差分法(DID法)と合成コントロール法(SC)を組み合わせた手法]{.underline}である。**

DID推定量は以下の通りであり $$
(\hat{\tau}^{DID}, \hat{\mu}, \hat{\alpha}, \hat{\beta})=argmin_{\mu,\alpha,\beta,\tau} \sum_{i=1}^N \sum_{t=1}^T(Y_{it}-\mu-\alpha_i-\beta_t-W_{it}\tau)^2
$$ 各ユニット・時間において二乗誤差を最小にするような上記モデルは定数$\mu$、時間効果$\beta$、個人効果$\alpha$の線形結合で表される。ここで、因果効果をとらえるのは処置変数$W_{it}$の係数$\hat{\tau}^{DID}$である。

*一方、*合成コントロール法は*Synthetic Control Methods for Comparative Case Studies*(*Abadie et al. 2010*) で提案された。

アイデアとしては、処置を受ける前まで処置群を統制群（処置を受けない群）の重み付け（加重平均）で近似できるような $\omega$ を求め、

$$
 (\hat{\tau}^{SDID}, \hat{\mu}, \hat{\alpha}, \hat{\beta})=argmin_{\mu,\alpha,\beta,\tau} (\sum_{i=1}^N \sum_{t=1}^T(Y_{it}-\mu-\alpha_i-\beta_t-W_{it}\tau)^2 \hat{\omega}^{SDID}_i \hat{\lambda}^{SDID}_t)
$$

## 北海道拓殖銀行破綻と道内経済への効果検証
```{r}
jpn1<-sf::read_sf(dsn="data/JPN_shp/gadm41_JPN_2.shp") 

mapview::mapview(x=jpn1) 
```



## 中国青海-西蔵鉄道開通による経済効果分析
